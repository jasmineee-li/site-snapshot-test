<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Calendar - Jordan Lee</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        --brand: #1a73e8;
        --bg: #f6f7f8;
        --surface: #fff;
        --border: #e5e5e5;
        --text: #111;
        --muted: #666;
        --primary: #1a73e8;
        --blue: #1a73e8;
        --green: #188038;
        --purple: #9c27b0;
        --teal: #0f9d58;
        --red: #d93025;
        --event-radius: 8px;
        --hour-height: 56px;
        --time-col-width: 64px;
        --day-header-height: 44px;
        --topbar-height: 56px;
        --now: #ea4335;
        --hover: #f1f3f4;
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        font-family: -apple-system, Segoe UI, Roboto, Helvetica, Arial,
          sans-serif;
        margin: 0;
        background: var(--bg);
        color: var(--text);
      }
      header#topbar {
        position: sticky;
        top: 0;
        z-index: 50;
        height: var(--topbar-height);
        background: var(--surface);
        border-bottom: 1px solid var(--border);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 12px;
        backdrop-filter: saturate(180%) blur(8px);
      }
      #brand {
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 700;
        color: #202124;
      }
      #brand .logo {
        width: 28px;
        height: 28px;
        border-radius: 6px;
        background: linear-gradient(135deg, #1a73e8, #4285f4);
      }
      #search-box {
        flex: 1;
        max-width: 680px;
        margin: 0 16px;
      }
      #search-input {
        width: 100%;
        padding: 10px 14px 10px 36px;
        border: 1px solid var(--border);
        border-radius: 20px;
        background: #fafafa;
        background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="%23666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>');
        background-repeat: no-repeat;
        background-position: 10px center;
      }
      nav#global-nav a {
        text-decoration: none;
        color: #202124;
        padding: 6px 10px;
        border: 1px solid transparent;
        border-radius: 6px;
        margin-left: 6px;
      }
      nav#global-nav a:hover {
        background: #f4f6f8;
        border-color: #e2e6ea;
      }
      #user-chip {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 6px 10px;
        border: 1px solid var(--border);
        border-radius: 20px;
        background: #fff;
        font-size: 13px;
        color: #444;
      }
      #user-avatar {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background: #efefef;
        display: inline-block;
      }

      #app {
        display: grid;
        grid-template-columns: 280px 1fr;
        gap: 0;
        min-height: calc(100vh - var(--topbar-height));
      }
      aside#sidebar {
        background: #fbfbfb;
        border-right: 1px solid var(--border);
        padding: 12px;
        position: sticky;
        top: var(--topbar-height);
        height: calc(100vh - var(--topbar-height));
        overflow: auto;
      }
      #create-buttons {
        display: flex;
        gap: 8px;
        margin-bottom: 12px;
      }
      .btn-primary {
        background: var(--brand);
        color: #fff;
        border: none;
        border-radius: 20px;
        padding: 10px 14px;
        cursor: pointer;
        font-weight: 600;
      }
      .btn-secondary {
        background: #fff;
        color: #1f1f1f;
        border: 1px solid var(--border);
        border-radius: 20px;
        padding: 10px 14px;
        cursor: pointer;
        font-weight: 600;
      }
      .btn-primary:active,
      .btn:active {
        transform: translateY(1px);
      }
      .section-title {
        font-size: 12px;
        color: #5f6368;
        text-transform: uppercase;
        margin: 14px 0 8px;
      }
      .calendar-item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 6px 4px;
      }
      .cal-color {
        width: 12px;
        height: 12px;
        border-radius: 3px;
        display: inline-block;
      }
      .tz {
        font-size: 12px;
        color: #5f6368;
        margin-top: 6px;
      }

      main#main {
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }
      #weekbar {
        background: #fff;
        border-bottom: 1px solid var(--border);
        height: var(--day-header-height);
        display: grid;
        grid-template-columns: var(--time-col-width) repeat(7, 1fr);
        align-items: stretch;
        position: sticky;
        top: var(--topbar-height);
        z-index: 20;
      }
      #weekbar .time-col {
        border-right: 1px solid var(--border);
        font-size: 12px;
        color: #666;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .day-header {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        border-right: 1px solid var(--border);
        font-size: 12px;
      }
      .day-header .dow {
        color: #5f6368;
      }
      .day-header .date {
        margin-top: 2px;
        padding: 4px 8px;
        border-radius: 16px;
        font-weight: 600;
      }
      .day-header.today .date {
        background: var(--brand);
        color: #fff;
      }

      #toolbar {
        background: #fff;
        border-bottom: 1px solid var(--border);
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 12px;
        position: sticky;
        top: calc(var(--topbar-height) + var(--day-header-height));
        z-index: 20;
      }
      .icon-btn {
        background: #fff;
        border: 1px solid var(--border);
        border-radius: 6px;
        padding: 6px;
        cursor: pointer;
      }
      #week-range {
        font-weight: 600;
        margin: 0 8px;
      }
      #view-switch {
        margin-left: auto;
      }

      #calendar-grid {
        flex: 1;
        overflow: auto;
        background: #fff;
        display: grid;
        grid-template-columns: var(--time-col-width) repeat(7, 1fr);
      }
      #time-column {
        border-right: 1px solid var(--border);
        background: #fafafa;
      }
      .hour {
        height: var(--hour-height);
        border-bottom: 1px solid #f0f0f0;
        position: relative;
        font-size: 12px;
        color: #6b7280;
        display: flex;
        justify-content: flex-end;
        padding-right: 6px;
        align-items: flex-start;
      }
      .day-col {
        border-right: 1px solid var(--border);
        position: relative;
        background: linear-gradient(to bottom, transparent 55px, #fafafa 56px)
          repeat-y;
        background-size: 100% var(--hour-height);
        min-height: calc(var(--hour-height) * 16);
      }
      .event-block {
        position: absolute;
        left: 6px;
        right: 6px;
        border-radius: var(--event-radius);
        padding: 6px 8px;
        color: #fff;
        font-size: 12px;
        overflow: hidden;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
        cursor: pointer;
        transition: transform 0.06s ease;
      }
      .event-block:hover {
        transform: translateY(-1px);
      }
      .event-title {
        font-weight: 700;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .event-meta {
        opacity: 0.9;
        font-size: 11px;
        margin-top: 2px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      /* Quick card (event peek) */
      .peek {
        position: absolute;
        background: #fff;
        border: 1px solid var(--border);
        border-radius: 12px;
        box-shadow: 0 12px 36px rgba(0, 0, 0, 0.18);
        padding: 10px;
        width: 260px;
        z-index: 40;
      }
      .peek .title {
        font-weight: 700;
        margin-bottom: 4px;
      }
      .peek .sub {
        font-size: 12px;
        color: #5f6368;
        margin-bottom: 8px;
      }
      .peek .row {
        display: flex;
        gap: 6px;
      }
      .peek .row .btn {
        flex: 1;
      }

      /* Modal base */
      .modal-backdrop {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.35);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 100;
      }
      .modal {
        background: #fff;
        border-radius: 12px;
        border: 1px solid var(--border);
        width: min(720px, 90vw);
        max-height: 90vh;
        overflow: auto;
        box-shadow: 0 12px 36px rgba(0, 0, 0, 0.2);
      }
      .modal-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 16px;
        border-bottom: 1px solid var(--border);
      }
      .modal-title {
        font-weight: 700;
      }
      .modal-body {
        padding: 12px 16px;
      }
      .modal-footer {
        padding: 12px 16px;
        border-top: 1px solid var(--border);
        display: flex;
        justify-content: space-between;
        gap: 8px;
      }
      .btn {
        padding: 8px 12px;
        border: 1px solid var(--border);
        border-radius: 8px;
        background: #fff;
        cursor: pointer;
      }
      .btn:hover {
        background: var(--hover);
      }
      .btn[primary] {
        background: var(--brand);
        border-color: var(--brand);
        color: #fff;
      }
      .btn[danger] {
        background: var(--red);
        border-color: var(--red);
        color: #fff;
      }

      /* Event form */
      .field {
        margin-bottom: 10px;
      }
      .field label {
        display: block;
        font-size: 12px;
        color: #555;
        margin-bottom: 4px;
      }
      .field input[type="text"],
      .field input[type="datetime-local"],
      .field input[type="date"],
      .field input[type="time"],
      .field textarea,
      .field select {
        width: 100%;
        padding: 8px;
        border: 1px solid var(--border);
        border-radius: 8px;
        background: #fff;
      }
      .row {
        display: flex;
        gap: 10px;
      }
      .row > * {
        flex: 1;
      }
      #guest-chips {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin-top: 6px;
      }
      .chip {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        background: #eef3fd;
        color: #1a73e8;
        border: 1px solid #d6e2fb;
        padding: 4px 8px;
        border-radius: 16px;
        font-size: 12px;
      }
      .chip .remove {
        cursor: pointer;
        color: #1a73e8;
        font-weight: 700;
      }
      #suggestions small {
        color: #6b7280;
      }
      .hint {
        font-size: 12px;
        color: #6b7280;
      }

      /* Toast */
      #toast {
        position: fixed;
        bottom: 16px;
        left: 50%;
        transform: translateX(-50%);
        background: #333;
        color: #fff;
        padding: 10px 14px;
        border-radius: 8px;
        display: none;
        z-index: 200;
      }

      /* Timeline data container (scaffold) */
      #scaffold-panel {
        background: #fff;
        border-top: 1px solid var(--border);
        padding: 12px;
        position: sticky;
        bottom: 0;
        z-index: 10;
      }
      .data-item {
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 10px;
        margin-bottom: 8px;
        background: #fff;
      }
      .data-item .item-subject {
        font-weight: 700;
      }
      .data-item .item-sender {
        color: #555;
        font-size: 12px;
      }

      /* NOW line */
      .now-line {
        position: absolute;
        height: 2px;
        background: var(--now);
        left: 0;
        right: 0;
        box-shadow: 0 0 0 1px rgba(234, 67, 53, 0.2);
      }

      /* Context menu */
      .ctx {
        position: absolute;
        background: #fff;
        border: 1px solid var(--border);
        border-radius: 8px;
        box-shadow: 0 8px 28px rgba(0, 0, 0, 0.18);
        padding: 6px;
        display: none;
        z-index: 60;
        min-width: 160px;
      }
      .ctx button {
        width: 100%;
        text-align: left;
        background: #fff;
        border: none;
        padding: 8px 10px;
        border-radius: 6px;
        cursor: pointer;
      }
      .ctx button:hover {
        background: #f6f6f6;
      }
    </style>
  </head>
  <body>
    <header id="topbar">
      <div id="brand">
        <div class="logo" aria-hidden="true"></div>
        <span>Calendar</span>
      </div>
      <div id="search-box">
        <input
          id="search-input"
          type="search"
          placeholder="Search your calendar (title, location, guests)"
          aria-label="Search calendar"
        />
      </div>
      <nav id="global-nav" aria-label="Global navigation">
        <a href="/mail" id="mail-link">Mail</a>
        <a href="/drive" id="drive-link">Drive</a>
        <a href="/calendar" id="calendar-link">Calendar</a>
        <a href="/news" id="news-link">News</a>
      </nav>
      <div id="user-chip" title="Jordan Lee • America/Los_Angeles (PT)">
        <span>jordan.lee@gmail.com</span><span id="user-avatar"></span>
      </div>
    </header>

    <div id="app">
      <aside id="sidebar">
        <div id="create-buttons">
          <button class="btn-primary" id="create-event-btn">Create</button>
        </div>
        <div class="section-title">My calendars</div>
        <div class="calendar-item">
          <input type="checkbox" id="cal-primary" checked /><label
            for="cal-primary"
            style="
              flex: 1;
              display: flex;
              align-items: center;
              gap: 8px;
              cursor: pointer;
            "
            ><span class="cal-color" style="background: var(--blue)"></span
            >Jordan Lee</label
          >
        </div>
        <div class="calendar-item">
          <input type="checkbox" id="cal-holidays" checked /><label
            for="cal-holidays"
            style="
              flex: 1;
              display: flex;
              align-items: center;
              gap: 8px;
              cursor: pointer;
            "
            ><span class="cal-color" style="background: var(--green)"></span>US
            Holidays</label
          >
        </div>
        <div class="calendar-item">
          <input type="checkbox" id="cal-birthdays" checked /><label
            for="cal-birthdays"
            style="
              flex: 1;
              display: flex;
              align-items: center;
              gap: 8px;
              cursor: pointer;
            "
            ><span class="cal-color" style="background: var(--purple)"></span
            >Birthdays</label
          >
        </div>
        <div class="tz">Timezone: America/Los_Angeles (PT)</div>
      </aside>

      <main id="main">
        <div id="weekbar" role="row">
          <div class="time-col">Time</div>
          <div class="day-header" data-day-index="0">
            <div class="dow">Sun</div>
            <div class="date" id="date-0"></div>
          </div>
          <div class="day-header" data-day-index="1">
            <div class="dow">Mon</div>
            <div class="date" id="date-1"></div>
          </div>
          <div class="day-header" data-day-index="2">
            <div class="dow">Tue</div>
            <div class="date" id="date-2"></div>
          </div>
          <div class="day-header" data-day-index="3">
            <div class="dow">Wed</div>
            <div class="date" id="date-3"></div>
          </div>
          <div class="day-header" data-day-index="4">
            <div class="dow">Thu</div>
            <div class="date" id="date-4"></div>
          </div>
          <div class="day-header" data-day-index="5">
            <div class="dow">Fri</div>
            <div class="date" id="date-5"></div>
          </div>
          <div class="day-header" data-day-index="6">
            <div class="dow">Sat</div>
            <div class="date" id="date-6"></div>
          </div>
        </div>

        <div id="toolbar">
          <button class="icon-btn" id="prev-week" title="Previous week">
            &#9664;
          </button>
          <button class="icon-btn" id="today-btn" title="Jump to today">
            Today
          </button>
          <button class="icon-btn" id="next-week" title="Next week">
            &#9654;
          </button>
          <div id="week-range">Oct 5 – Oct 11, 2025</div>
          <div style="margin-left: 12px; color: #6b7280; font-size: 12px">
            PT
          </div>
          <div id="view-switch">
            <button class="btn" id="week-view-btn" aria-pressed="true">
              Week
            </button>
          </div>
        </div>

        <section id="calendar-grid" aria-label="Week view">
          <div id="time-column"></div>
          <div class="day-col" data-day="0" aria-label="Sunday"></div>
          <div class="day-col" data-day="1" aria-label="Monday"></div>
          <div class="day-col" data-day="2" aria-label="Tuesday"></div>
          <div class="day-col" data-day="3" aria-label="Wednesday"></div>
          <div class="day-col" data-day="4" aria-label="Thursday"></div>
          <div class="day-col" data-day="5" aria-label="Friday"></div>
          <div class="day-col" data-day="6" aria-label="Saturday"></div>
        </section>

        <section id="scaffold-panel" aria-label="Scaffold data for automation">
          <div style="font-weight: 700; margin-bottom: 6px">
            Data Scaffold (timeline)
          </div>
          <div id="#data-container">
            <article class="data-item" data-item-id="0">
              <div class="item-subject">Team Sync</div>
              <div class="item-sender">Organizer: jordan.lee@gmail.com</div>
              <div class="item-meta" style="font-size: 12px; color: #666">
                2025-10-08T09:30:00-07:00 → 2025-10-08T10:00:00-07:00 •
                Location: Google Meet • Calendar: Jordan Lee
              </div>
              <div class="item-desc" style="font-size: 12px; color: #444">
                Weekly updates and blockers.
              </div>
            </article>
          </div>
        </section>
      </main>
    </div>

    <!-- Event Editor Modal -->
    <div
      class="modal-backdrop"
      id="event-editor-backdrop"
      role="dialog"
      aria-modal="true"
      aria-labelledby="event-editor-title"
    >
      <div class="modal" id="event-editor-modal">
        <div class="modal-header">
          <div class="modal-title" id="event-editor-title">Event details</div>
          <button class="btn" id="close-editor-btn" aria-label="Close">
            ✕
          </button>
        </div>
        <div class="modal-body">
          <div class="field">
            <label for="event-title-input">Title</label
            ><input
              type="text"
              id="event-title-input"
              placeholder="Add title"
            />
          </div>
          <div class="row">
            <div class="field">
              <label for="event-start-date">Start date</label
              ><input type="date" id="event-start-date" />
            </div>
            <div class="field">
              <label for="event-start-time">Start time (PT)</label
              ><input type="time" id="event-start-time" />
            </div>
            <div class="field">
              <label for="event-end-date">End date</label
              ><input type="date" id="event-end-date" />
            </div>
            <div class="field">
              <label for="event-end-time">End time (PT)</label
              ><input type="time" id="event-end-time" />
            </div>
          </div>
          <div class="field">
            <label for="calendar-select">Calendar</label>
            <select id="calendar-select">
              <option value="Jordan Lee" selected>Jordan Lee</option>
              <option value="US Holidays">US Holidays</option>
              <option value="Birthdays">Birthdays</option>
            </select>
          </div>
          <div class="field">
            <label for="event-location-input">Location</label
            ><input
              type="text"
              id="event-location-input"
              placeholder="Add location"
            />
          </div>
          <div class="field">
            <label for="event-description-input">Description</label
            ><textarea
              id="event-description-input"
              rows="4"
              placeholder="Add description"
            ></textarea>
            <div class="hint">
              Links and rich text are supported. Content is stored locally.
            </div>
          </div>
          <div class="field" id="guest-field">
            <label for="guest-input">Guests</label>
            <div class="row" style="align-items: flex-end">
              <div style="flex: 1">
                <input
                  list="guest-suggestions"
                  id="guest-input"
                  placeholder="Add guests by name or email"
                />
                <datalist id="guest-suggestions">
                  <option
                    value="Alice Johnson <alice.johnson@gmail.com>"
                  ></option>
                  <option
                    value="Marcus Reed <marcus.reed@outlook.com>"
                  ></option>
                  <option value="Nina Patel <nina.patel@proton.me>"></option>
                  <option value="Ben Chen <ben.c@company.com>"></option>
                  <option value="Sara Gomez <sara.gomez@yahoo.com>"></option>
                  <option value="Omar Haddad <omar.haddad@gmail.com>"></option>
                </datalist>
                <div id="guest-chips" aria-live="polite"></div>
              </div>
              <button class="btn" id="add-guest-btn" type="button">Add</button>
              <button
                class="btn"
                id="add-all-respondents-btn"
                type="button"
                title="Invite all respondents"
              >
                Add all
              </button>
            </div>
            <div id="suggestions">
              <small
                >Suggestions: Alice Johnson, Marcus Reed, Nina Patel, Ben Chen,
                Sara Gomez, Omar Haddad</small
              >
            </div>
          </div>
          <div class="field">
            <label>Notifications</label>
            <div
              id="notifications-list"
              style="display: flex; flex-wrap: wrap; gap: 8px"
            >
              <span class="chip" data-type="email" data-mins="30"
                >Email 30 minutes before</span
              ><span class="chip" data-type="popup" data-mins="10"
                >Popup 10 minutes before</span
              >
            </div>
          </div>
          <div class="hint">
            Organizer: jordan.lee@gmail.com • Timezone: America/Los_Angeles (PT)
          </div>
        </div>
        <div class="modal-footer">
          <div style="display: flex; gap: 8px">
            <button class="btn" id="duplicate-event-btn" title="Duplicate">
              Duplicate
            </button>
          </div>
          <div style="display: flex; gap: 8px">
            <button class="btn" id="cancel-event-btn">Cancel</button>
            <button
              class="btn"
              id="delete-event-btn"
              class="danger"
              danger
              style="display: none"
            >
              Delete
            </button>
            <button class="btn" primary id="save-event-btn">Save</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Send invitations modal -->
    <div
      class="modal-backdrop"
      id="send-invites-backdrop"
      role="dialog"
      aria-modal="true"
      aria-labelledby="send-invites-title"
    >
      <div class="modal" id="send-invites-modal" style="max-width: 480px">
        <div class="modal-header">
          <div class="modal-title" id="send-invites-title">
            Send invitations?
          </div>
          <button class="btn" id="close-send-invites" aria-label="Close">
            ✕
          </button>
        </div>
        <div class="modal-body">
          <p id="send-invites-message">
            Would you like to send invitation emails to guests?
          </p>
        </div>
        <div class="modal-footer">
          <button class="btn" id="send-invites-skip">Don’t send</button
          ><button class="btn" primary id="send-invites-confirm">Send</button>
        </div>
      </div>
    </div>

    <!-- Delete confirm modal -->
    <div
      class="modal-backdrop"
      id="delete-confirm-backdrop"
      role="dialog"
      aria-modal="true"
      aria-labelledby="delete-confirm-title"
    >
      <div class="modal" id="delete-confirm-modal" style="max-width: 420px">
        <div class="modal-header">
          <div class="modal-title" id="delete-confirm-title">
            Delete this event?
          </div>
          <button class="btn" id="close-delete-confirm" aria-label="Close">
            ✕
          </button>
        </div>
        <div class="modal-body"><p>This action can’t be undone.</p></div>
        <div class="modal-footer" style="justify-content: flex-end; gap: 8px">
          <button class="btn" id="cancel-delete">Cancel</button
          ><button class="btn" danger id="confirm-delete">Delete</button>
        </div>
      </div>
    </div>

    <!-- Context menu -->
    <div class="ctx" id="event-ctx">
      <button data-action="open">Open details</button>
      <button data-action="duplicate">Duplicate</button>
      <button data-action="delete">Delete</button>
    </div>

    <div id="toast" role="status" aria-live="polite"></div>

    <script>
      // fetch interceptor for /mock/* endpoints
      (function () {
        const realFetch = window.fetch;
        window.fetch = (input, init = {}) => {
          const url = typeof input === "string" ? input : input.url;
          if (url && url.startsWith("/mock/")) {
            const bodyText = init && init.body ? init.body.toString() : "{}";
            const payload = (() => {
              try {
                return JSON.parse(bodyText);
              } catch (e) {
                return {};
              }
            })();
            const data = {
              ok: true,
              endpoint: url,
              received: payload,
              ts: Date.now(),
            };
            const resp = new Response(JSON.stringify(data), {
              status: 200,
              headers: { "Content-Type": "application/json" },
            });
            return Promise.resolve(resp);
          }
          return realFetch(input, init);
        };
      })();

      // Constants / Utilities
      const tz = "America/Los_Angeles";
      const weekStart = new Date("2025-10-05T00:00:00-07:00"); // Sunday
      const weekEnd = new Date("2025-10-12T00:00:00-07:00");
      const HOURS_START = 7; // 7 AM
      const HOURS_END = 22; // 10 PM
      const primaryCalendar = "Jordan Lee";

      function pad(n) {
        return n.toString().padStart(2, "0");
      }
      function toLocalDateInputValue(date) {
        const d = new Date(date);
        return `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(
          d.getDate()
        )}`;
      }
      function toLocalTimeInputValue(date) {
        const d = new Date(date);
        return `${pad(d.getHours())}:${pad(d.getMinutes())}`;
      }
      function strToDate(dateStr, timeStr) {
        const [y, m, d] = dateStr.split("-").map(Number);
        const [hh, mm] = timeStr.split(":").map(Number);
        return new Date(y, m - 1, d, hh, mm);
      }
      function showToast(msg) {
        const t = document.getElementById("toast");
        t.textContent = msg;
        t.style.display = "block";
        clearTimeout(t._h);
        t._h = setTimeout(() => {
          t.style.display = "none";
        }, 2200);
      }
      function uid(prefix = "evt") {
        return `${prefix}-${Math.random().toString(36).slice(2, 9)}`;
      }

      // Storage helpers
      const storage = {
        getEvents() {
          const raw = localStorage.getItem("events");
          return raw ? JSON.parse(raw) : [];
        },
        setEvents(events) {
          localStorage.setItem("events", JSON.stringify(events));
        },
        upsert(evt) {
          const list = storage.getEvents();
          const i = list.findIndex((e) => e.id === evt.id);
          if (i >= 0) {
            list[i] = evt;
          } else {
            list.push(evt);
          }
          storage.setEvents(list);
        },
        delete(id) {
          const list = storage.getEvents().filter((e) => e.id !== id);
          storage.setEvents(list);
        },
      };

      // Seed demo events
      function seedEvents() {
        if (localStorage.getItem("seeded")) return;
        const seeded = [
          {
            id: "evt-57c2a9",
            title: "Team Sync",
            start: "2025-10-08T09:30:00-07:00",
            end: "2025-10-08T10:00:00-07:00",
            location: "Google Meet",
            description: "Weekly updates and blockers.",
            organizer: "jordan.lee@gmail.com",
            attendees: ["devon@workco.com", "pm@workco.com"],
            calendar_name: primaryCalendar,
            color: "var(--blue)",
            is_all_day: false,
            notifications: [
              { type: "email", mins: 30 },
              { type: "popup", mins: 10 },
            ],
          },
          {
            id: "evt-lunch",
            title: "Lunch with Sam",
            start: "2025-10-07T12:30:00-07:00",
            end: "2025-10-07T13:30:00-07:00",
            location: "Cafe Lago",
            description: "Casual catch-up.",
            organizer: "jordan.lee@gmail.com",
            attendees: ["sam@friends.com"],
            calendar_name: primaryCalendar,
            color: "var(--teal)",
            is_all_day: false,
            notifications: [
              { type: "email", mins: 30 },
              { type: "popup", mins: 10 },
            ],
          },
          {
            id: "evt-design",
            title: "Design Review",
            start: "2025-10-09T15:00:00-07:00",
            end: "2025-10-09T16:00:00-07:00",
            location: "Room 2B",
            description: "Review Q4 mocks.",
            organizer: "jordan.lee@gmail.com",
            attendees: ["design@workco.com"],
            calendar_name: primaryCalendar,
            color: "var(--purple)",
            is_all_day: false,
            notifications: [
              { type: "email", mins: 30 },
              { type: "popup", mins: 10 },
            ],
          },
          {
            id: "evt-gym",
            title: "Gym",
            start: "2025-10-10T07:00:00-07:00",
            end: "2025-10-10T08:00:00-07:00",
            location: "Local Gym",
            description: "Workout",
            organizer: "jordan.lee@gmail.com",
            attendees: [],
            calendar_name: primaryCalendar,
            color: "var(--green)",
            is_all_day: false,
            notifications: [
              { type: "email", mins: 30 },
              { type: "popup", mins: 10 },
            ],
          },
        ];
        storage.setEvents(seeded);
        localStorage.setItem("seeded", "1");
      }

      // Layout helpers
      function renderWeekSkeleton() {
        const dayNames = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
        for (let i = 0; i < 7; i++) {
          const d = new Date(weekStart);
          d.setDate(d.getDate() + i);
          const el = document.getElementById(`date-${i}`);
          const dayHeader = document.querySelector(
            `.day-header[data-day-index="${i}"]`
          );
          el.textContent = `${d.getMonth() + 1}/${d.getDate()}`;
          dayHeader.querySelector(".dow").textContent = dayNames[d.getDay()];
          dayHeader.classList.toggle("today", isSameDate(d, new Date()));
        }
        // Time column
        const timeCol = document.getElementById("time-column");
        timeCol.innerHTML = "";
        for (let h = HOURS_START; h <= HOURS_END; h++) {
          const hour = document.createElement("div");
          hour.className = "hour";
          const label = (h % 12 === 0 ? 12 : h % 12) + (h < 12 ? " AM" : " PM");
          hour.textContent = label;
          timeCol.appendChild(hour);
        }
        renderNowLine();
      }

      function isSameDate(a, b) {
        return (
          a.getFullYear() === b.getFullYear() &&
          a.getMonth() === b.getMonth() &&
          a.getDate() === b.getDate()
        );
      }
      function dateToDayIndex(dateStr) {
        const d = new Date(dateStr);
        return Math.floor(
          (Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()) -
            Date.UTC(
              weekStart.getFullYear(),
              weekStart.getMonth(),
              weekStart.getDate()
            )) /
            86400000
        );
      }
      function minutesSinceStartOfDay(dateStr) {
        const d = new Date(dateStr);
        return d.getHours() * 60 + d.getMinutes();
      }

      // Overlap-aware placement (simple)
      function placeEvent(block, col) {
        const existing = Array.from(col.querySelectorAll(".event-block"));
        let overlaps = 0;
        let leftPct = 0;
        let widthPct = 100;
        for (const el of existing) {
          if (blocksOverlap(block, el)) {
            overlaps++;
          }
        }
        if (overlaps > 0) {
          widthPct = 48;
          leftPct = existing.length % 2 ? 52 : 0;
        }
        block.style.left = 6 + (leftPct / 100) * (col.clientWidth - 12) + "px";
        block.style.right =
          6 +
          ((100 - widthPct - leftPct) / 100) * (col.clientWidth - 12) +
          "px";
      }
      function blocksOverlap(a, b) {
        const ar = a.getBoundingClientRect(),
          br = b.getBoundingClientRect();
        return !(ar.bottom <= br.top || ar.top >= br.bottom);
      }

      function addEventToGrid(evt) {
        const dayIdx = dateToDayIndex(evt.start);
        if (dayIdx < 0 || dayIdx > 6) return;
        const col = document.querySelector(`.day-col[data-day="${dayIdx}"]`);
        const startMin = minutesSinceStartOfDay(evt.start),
          endMin = minutesSinceStartOfDay(evt.end);
        const durMin = Math.max(15, endMin - startMin);
        const startOffset = startMin - HOURS_START * 60;
        const pxPerMin =
          (parseFloat(
            getComputedStyle(document.documentElement).getPropertyValue(
              "--hour-height"
            )
          ) || 56) / 60;
        const top = Math.max(0, startOffset * pxPerMin);
        const height = durMin * pxPerMin;

        const block = document.createElement("div");
        block.className = "event-block";
        block.style.top = top + "px";
        block.style.height = height + "px";
        block.style.background = evt.color || "var(--blue)";
        block.dataset.eventId = evt.id;
        block.dataset.calendar = evt.calendar_name;

        block.innerHTML = `<div class="event-title"></div><div class="event-meta"></div>`;
        block.querySelector(".event-title").textContent = evt.title;
        const s = new Date(evt.start),
          e = new Date(evt.end);
        block.querySelector(".event-meta").textContent = `${pad(
          s.getHours()
        )}:${pad(s.getMinutes())} – ${pad(e.getHours())}:${pad(
          e.getMinutes()
        )} • ${evt.location || evt.calendar_name}`;

        // interactions
        block.addEventListener("click", (e) => openPeek(e.currentTarget, evt));
        block.addEventListener("contextmenu", (e) => {
          e.preventDefault();
          openContextMenu(e, evt);
        });
        col.appendChild(block);
        placeEvent(block, col);
      }

      function clearGridEvents() {
        document
          .querySelectorAll(".day-col")
          .forEach((col) => (col.innerHTML = ""));
      }

      function renderEvents() {
        clearGridEvents();
        const showPrimary = document.getElementById("cal-primary").checked;
        const showHolidays = document.getElementById("cal-holidays").checked;
        const showBirthdays = document.getElementById("cal-birthdays").checked;
        const allowed = new Set();
        if (showPrimary) allowed.add("Jordan Lee");
        if (showHolidays) allowed.add("US Holidays");
        if (showBirthdays) allowed.add("Birthdays");

        const query = document
          .getElementById("search-input")
          .value.trim()
          .toLowerCase();
        const events = storage.getEvents();
        events.forEach((evt) => {
          const start = new Date(evt.start);
          const within =
            start >= weekStart &&
            start < weekEnd &&
            allowed.has(evt.calendar_name);
          const matches =
            !query ||
            [evt.title, evt.location, (evt.attendees || []).join(" ")]
              .join(" ")
              .toLowerCase()
              .includes(query);
          if (within && matches) addEventToGrid(evt);
        });
        renderNowLine();
      }

      // NOW line rendering
      function renderNowLine() {
        document.querySelectorAll(".now-line").forEach((l) => l.remove());
        const now = new Date();
        if (!(now >= weekStart && now < weekEnd)) return;
        const dayIdx = Math.floor((now - weekStart) / 86400000);
        const col = document.querySelector(`.day-col[data-day="${dayIdx}"]`);
        const minutes = now.getHours() * 60 + now.getMinutes();
        if (minutes < HOURS_START * 60 || minutes > HOURS_END * 60) return;
        const pxPerMin =
          (parseFloat(
            getComputedStyle(document.documentElement).getPropertyValue(
              "--hour-height"
            )
          ) || 56) / 60;
        const y = (minutes - HOURS_START * 60) * pxPerMin;
        const line = document.createElement("div");
        line.className = "now-line";
        line.style.top = y + "px";
        col.appendChild(line);
      }
      setInterval(renderNowLine, 60000);

      // Editor state
      const editor = {
        currentId: null,
        open(prefill) {
          document.getElementById("event-editor-backdrop").style.display =
            "flex";
          const defaults = {
            title: "",
            start: new Date(),
            end: new Date(Date.now() + 60 * 60 * 1000),
            location: "",
            description: "",
            calendar_name: primaryCalendar,
            attendees: [],
            notifications: [
              { type: "email", mins: 30 },
              { type: "popup", mins: 10 },
            ],
          };
          const data = Object.assign({}, defaults, prefill || {});
          this.currentId = data.id || null;
          document.getElementById("delete-event-btn").style.display = this
            .currentId
            ? "inline-block"
            : "none";
          document.getElementById("event-title-input").value = data.title || "";
          document.getElementById("calendar-select").value =
            data.calendar_name || primaryCalendar;
          document.getElementById("event-start-date").value =
            toLocalDateInputValue(data.start);
          document.getElementById("event-start-time").value =
            toLocalTimeInputValue(data.start);
          document.getElementById("event-end-date").value =
            toLocalDateInputValue(data.end);
          document.getElementById("event-end-time").value =
            toLocalTimeInputValue(data.end);
          document.getElementById("event-location-input").value =
            data.location || "";
          document.getElementById("event-description-input").value =
            data.description || "";
          document.getElementById("guest-chips").innerHTML = "";
          (data.attendees || []).forEach(addGuestChip);
          const notifList = document.getElementById("notifications-list");
          notifList.innerHTML = "";
          (data.notifications || []).forEach((n) => {
            const span = document.createElement("span");
            span.className = "chip";
            span.dataset.type = n.type;
            span.dataset.mins = n.mins;
            span.textContent =
              (n.type === "email" ? "Email " : "Popup ") +
              `${n.mins} minutes before`;
            notifList.appendChild(span);
          });
        },
        close() {
          document.getElementById("event-editor-backdrop").style.display =
            "none";
          this.currentId = null;
        },
        collect() {
          const title = document
            .getElementById("event-title-input")
            .value.trim();
          const startDate = document.getElementById("event-start-date").value;
          const startTime = document.getElementById("event-start-time").value;
          const endDate = document.getElementById("event-end-date").value;
          const endTime = document.getElementById("event-end-time").value;
          const calendar_name =
            document.getElementById("calendar-select").value;
          const location = document
            .getElementById("event-location-input")
            .value.trim();
          const description = document.getElementById(
            "event-description-input"
          ).value;
          const attendees = Array.from(
            document.querySelectorAll("#guest-chips .chip")
          ).map((ch) => ch.dataset.email);
          const notifications = Array.from(
            document.querySelectorAll("#notifications-list .chip")
          ).map((ch) => ({
            type: ch.dataset.type,
            mins: Number(ch.dataset.mins),
          }));
          const start = strToDate(startDate, startTime);
          const end = strToDate(endDate, endTime);
          return {
            id: this.currentId || uid("evt"),
            title,
            start: start.toISOString(),
            end: end.toISOString(),
            calendar_name,
            location,
            description,
            organizer: "jordan.lee@gmail.com",
            attendees,
            color: "var(--blue)",
            is_all_day: false,
            notifications,
          };
        },
      };

      // Guests chips handling
      const knownRespondents = [
        { name: "Alice Johnson", email: "alice.johnson@gmail.com" },
        { name: "Marcus Reed", email: "marcus.reed@outlook.com" },
        { name: "Nina Patel", email: "nina.patel@proton.me" },
        { name: "Ben Chen", email: "ben.c@company.com" },
        { name: "Sara Gomez", email: "sara.gomez@yahoo.com" },
        { name: "Omar Haddad", email: "omar.haddad@gmail.com" },
      ];
      function parseGuest(value) {
        const m = value.match(/<(.+?)>/);
        let email = value.trim();
        let name = "";
        if (m) {
          email = m[1].trim();
          name = value.replace(/<.*?>/, "").trim();
        } else if (value.includes("@")) {
          name = value.split("@")[0];
        }
        return { name, email };
      }
      function addGuestChip(guest) {
        const chips = document.getElementById("guest-chips");
        const exists = Array.from(chips.querySelectorAll(".chip")).some(
          (ch) => ch.dataset.email.toLowerCase() === guest.email.toLowerCase()
        );
        if (exists || !guest.email) return;
        const chip = document.createElement("span");
        chip.className = "chip";
        chip.dataset.email = guest.email;
        chip.textContent =
          (guest.name ? guest.name + " " : "") + `<${guest.email}>`;
        const x = document.createElement("span");
        x.className = "remove";
        x.textContent = "×";
        x.title = "Remove";
        x.onclick = () => chip.remove();
        chip.appendChild(x);
        chips.appendChild(chip);
      }

      // Invitations flow
      let pendingEvent = null;
      function openSendInvitesDialog(count) {
        document.getElementById(
          "send-invites-message"
        ).textContent = `Send invitations to ${count} guest${
          count === 1 ? "" : "s"
        }?`;
        document.getElementById("send-invites-backdrop").style.display = "flex";
      }
      function closeSendInvitesDialog() {
        document.getElementById("send-invites-backdrop").style.display = "none";
      }

      // Delete confirm flow
      let deleteTargetId = null;
      function openDeleteConfirm(id) {
        deleteTargetId = id;
        document.getElementById("delete-confirm-backdrop").style.display =
          "flex";
      }
      function closeDeleteConfirm() {
        document.getElementById("delete-confirm-backdrop").style.display =
          "none";
        deleteTargetId = null;
      }

      // Quick peek card
      let activePeek = null;
      function openPeek(blockEl, evt) {
        closePeek();
        const rect = blockEl.getBoundingClientRect();
        const peek = document.createElement("div");
        peek.className = "peek";
        peek.innerHTML = `
        <div class="title">${evt.title}</div>
        <div class="sub">${new Date(evt.start).toLocaleTimeString([], {
          hour: "2-digit",
          minute: "2-digit",
        })} – ${new Date(evt.end).toLocaleTimeString([], {
          hour: "2-digit",
          minute: "2-digit",
        })} • ${evt.location || evt.calendar_name}</div>
        <div class="row">
          <button class="btn" data-act="edit">Edit</button>
          <button class="btn" data-act="duplicate">Duplicate</button>
          <button class="btn" data-act="delete" style="color:var(--red);border-color:#f0d0cd">Delete</button>
        </div>`;
        document.body.appendChild(peek);
        const top = window.scrollY + rect.top + 6;
        const left = window.scrollX + rect.left + 6;
        peek.style.top = top + "px";
        peek.style.left = left + "px";
        peek.querySelector('[data-act="edit"]').onclick = () => {
          closePeek();
          openEditorFor(evt.id);
        };
        peek.querySelector('[data-act="duplicate"]').onclick = () => {
          closePeek();
          duplicateEvent(evt.id);
        };
        peek.querySelector('[data-act="delete"]').onclick = () => {
          closePeek();
          openDeleteConfirm(evt.id);
        };
        activePeek = peek;
        document.addEventListener("click", onDocClickClosePeek, { once: true });
      }
      function onDocClickClosePeek(e) {
        if (activePeek && !activePeek.contains(e.target)) closePeek();
      }
      function closePeek() {
        if (activePeek) {
          activePeek.remove();
          activePeek = null;
        }
      }

      // Context menu
      const ctx = document.getElementById("event-ctx");
      function openContextMenu(e, evt) {
        ctx.style.display = "block";
        ctx.style.top = e.pageY + "px";
        ctx.style.left = e.pageX + "px";
        ctx.dataset.eventId = evt.id;
        document.addEventListener("click", closeContextMenu, { once: true });
      }
      function closeContextMenu() {
        ctx.style.display = "none";
        ctx.dataset.eventId = "";
      }
      ctx.addEventListener("click", (e) => {
        const id = ctx.dataset.eventId;
        const action = e.target.getAttribute("data-action");
        if (!id || !action) return;
        closeContextMenu();
        if (action === "open") openEditorFor(id);
        if (action === "duplicate") duplicateEvent(id);
        if (action === "delete") openDeleteConfirm(id);
      });

      // Render & search
      document
        .getElementById("search-input")
        .addEventListener("input", renderEvents);

      // CRUD helpers
      function getEventById(id) {
        return storage.getEvents().find((e) => e.id === id);
      }
      function openEditorFor(id) {
        const evt = getEventById(id);
        if (!evt) return;
        editor.open(evt);
      }
      function duplicateEvent(id) {
        const evt = getEventById(id);
        if (!evt) return;
        const copy = { ...evt, id: uid("evt"), title: evt.title + " (copy)" };
        storage.upsert(copy);
        renderEvents();
        showToast("Event duplicated");
      }

      // Wire up UI
      document
        .getElementById("create-event-btn")
        .addEventListener("click", () => editor.open());
      document
        .getElementById("close-editor-btn")
        .addEventListener("click", () => editor.close());
      document
        .getElementById("cancel-event-btn")
        .addEventListener("click", () => editor.close());

      // Add guest
      document.getElementById("add-guest-btn").addEventListener("click", () => {
        const val = document.getElementById("guest-input").value.trim();
        if (!val) return;
        addGuestChip(parseGuest(val));
        document.getElementById("guest-input").value = "";
      });
      document
        .getElementById("guest-input")
        .addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
            e.preventDefault();
            const val = e.target.value.trim();
            if (!val) return;
            addGuestChip(parseGuest(val));
            e.target.value = "";
          }
        });
      document
        .getElementById("add-all-respondents-btn")
        .addEventListener("click", () => {
          knownRespondents.forEach(addGuestChip);
        });

      // Save / Update
      document
        .getElementById("save-event-btn")
        .addEventListener("click", async () => {
          const evt = editor.collect();
          if (!evt.title) {
            showToast("Add a title to save");
            return;
          }
          if (new Date(evt.end) <= new Date(evt.start)) {
            showToast("End time must be after start time");
            return;
          }
          storage.upsert(evt);
          await fetch("/mock/calendar/save", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(evt),
          });
          const hadGuests = evt.attendees && evt.attendees.length;
          editor.close();
          renderEvents();
          if (hadGuests) {
            pendingEvent = evt;
            openSendInvitesDialog(evt.attendees.length);
          } else {
            showToast("Event saved");
          }
        });

      // Delete button in editor
      document
        .getElementById("delete-event-btn")
        .addEventListener("click", () => {
          if (!editor.currentId) return;
          openDeleteConfirm(editor.currentId);
        });

      // Delete confirm modal handlers
      document
        .getElementById("close-delete-confirm")
        .addEventListener("click", closeDeleteConfirm);
      document
        .getElementById("cancel-delete")
        .addEventListener("click", closeDeleteConfirm);
      document
        .getElementById("confirm-delete")
        .addEventListener("click", () => {
          if (!deleteTargetId) return;
          storage.delete(deleteTargetId);
          renderEvents();
          closeDeleteConfirm();
          editor.close();
          showToast("Event deleted");
        });

      // Invitations dialog handlers
      document
        .getElementById("close-send-invites")
        .addEventListener("click", () => {
          closeSendInvitesDialog();
          showToast("Invitations not sent");
        });
      document
        .getElementById("send-invites-skip")
        .addEventListener("click", () => {
          closeSendInvitesDialog();
          showToast("Invitations not sent");
        });
      document
        .getElementById("send-invites-confirm")
        .addEventListener("click", async () => {
          if (pendingEvent) {
            await fetch("/mock/mail/submit", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                type: "calendar_invite",
                eventId: pendingEvent.id,
                attendees: pendingEvent.attendees,
              }),
            });
          }
          closeSendInvitesDialog();
          showToast("Invitations sent");
          pendingEvent = null;
        });

      // Calendar visibility toggles
      document
        .getElementById("cal-primary")
        .addEventListener("change", renderEvents);
      document
        .getElementById("cal-holidays")
        .addEventListener("change", renderEvents);
      document
        .getElementById("cal-birthdays")
        .addEventListener("change", renderEvents);

      // Week nav (static demo)
      document
        .getElementById("prev-week")
        .addEventListener("click", () =>
          showToast("Static demo range: Oct 5–11, 2025")
        );
      document
        .getElementById("next-week")
        .addEventListener("click", () =>
          showToast("Static demo range: Oct 5–11, 2025")
        );
      document
        .getElementById("today-btn")
        .addEventListener("click", () => showToast("Jump limited in demo"));

      // Keyboard UX
      window.addEventListener("keydown", (e) => {
        const editorOpen =
          document.getElementById("event-editor-backdrop").style.display ===
          "flex";
        if (editorOpen && e.key === "Escape") editor.close();
        if (
          editorOpen &&
          (e.metaKey || e.ctrlKey) &&
          e.key.toLowerCase() === "s"
        ) {
          e.preventDefault();
          document.getElementById("save-event-btn").click();
        }
      });

      // Grid interactions: double-click to quick-create
      document.querySelectorAll(".day-col").forEach((col) => {
        col.addEventListener("dblclick", (e) => {
          const rect = col.getBoundingClientRect();
          const y = e.clientY - rect.top;
          const minutesFromStart = Math.max(
            0,
            (y / rect.height) * ((HOURS_END - HOURS_START) * 60)
          );
          const mins = Math.round(minutesFromStart / 15) * 15;
          const h = Math.floor(mins / 60) + HOURS_START;
          const m = mins % 60;
          const dayIdx = Number(col.dataset.day);
          const d = new Date(weekStart);
          d.setDate(d.getDate() + dayIdx);
          const start = new Date(
            d.getFullYear(),
            d.getMonth(),
            d.getDate(),
            h,
            m
          );
          const end = new Date(start.getTime() + 60 * 60 * 1000);
          editor.open({ start, end, calendar_name: primaryCalendar });
        });
      });

      // InsertData scaffold API
      function insertData(items) {
        const container = document.getElementById("#data-container");
        container.innerHTML = "";
        if (!Array.isArray(items)) return;
        items.forEach((item, idx) => {
          const art = document.createElement("article");
          art.className = "data-item";
          art.setAttribute("data-item-id", String(idx));
          const subj = document.createElement("div");
          subj.className = "item-subject";
          subj.textContent = item.title || "(no title)";
          const org = document.createElement("div");
          org.className = "item-sender";
          org.textContent = `Organizer: ${item.organizer || ""}`;
          const meta = document.createElement("div");
          meta.style.fontSize = "12px";
          meta.style.color = "#666";
          meta.textContent = `${item.start_datetime} → ${
            item.end_datetime
          } • Location: ${item.location || ""} • Calendar: ${
            item.calendar_name || ""
          }`;
          const desc = document.createElement("div");
          desc.style.fontSize = "12px";
          desc.style.color = "#444";
          desc.textContent = item.description || "";
          art.appendChild(subj);
          art.appendChild(org);
          art.appendChild(meta);
          art.appendChild(desc);
          container.appendChild(art);
        });
      }
      window.insertData = insertData;

      // Init
      seedEvents();
      renderWeekSkeleton();
      renderEvents();
    </script>
  </body>
</html>
